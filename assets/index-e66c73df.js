(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();const D=["https://brasilapi.com.br/api/cep/v2/","https://cep.awesomeapi.com.br/json/"],P=document.querySelector(".cart__address"),H=async t=>(await Promise.any(D.map(async e=>fetch(`${e}${t}`)))).json(),W=async t=>{try{const e=await H(t);if(!e.address&&!e.street)throw new Error("CEP não encontrado");const o=e.address??e.street,s=e.district??e.neighborhood;P.innerHTML=`${o} - ${s} - ${e.city} - ${e.state}`}catch(e){console.error(e),P.innerHTML="CEP não encontrado"}},_=["https://api.mercadolibre.com/sites/MLB/search?","https://api.mercadolibre.com/items/","https://api.mercadolibre.com/sites/MLB/categories"],$=async t=>{if(!t)throw new Error("ID não informado");return(await fetch(`${_[1]}${t}`)).json()},j=async(t,e)=>{if(!t)throw new Error("Termo de busca não informado");return(await(await fetch(`${_[0]}${e}=${t}`)).json()).results},A=async()=>(await fetch(_[2])).json(),v=()=>{const t=localStorage.getItem("cartProducts");return t?JSON.parse(t):[]},J=t=>{if(!t)throw new Error("Você deve fornecer um ID");const o=[...v(),t];localStorage.setItem("cartProducts",JSON.stringify(o))},U=t=>{if(!t)throw new Error("Você deve fornecer um ID");const e=[...v()],o=e.indexOf(t);e.splice(o,1),localStorage.setItem("cartProducts",JSON.stringify(e))},f=t=>{const e=document.createElement("img");return e.className="product__image",e.src=t.replace("I.jpg","O.jpg"),e},c=(t,e,o="")=>{const s=document.createElement(t);return s.className=e,s.innerText=o,s},F=(t,e)=>{t.remove(),U(e)},N=t=>{const e=typeof t=="number"?t.toString():t;return e.includes(".")?e[e.length-2]==="."?`${e}0`:e:`${e}.00`},T=({id:t,title:e,price:o,pictures:s})=>{const n=document.createElement("li");n.className="cart__product";const r=c("div","cart__product__image-container"),i=f(s[0].url);r.appendChild(i);const y=f((s[1]||s[0]).url);r.appendChild(y),n.appendChild(r);const h=c("div","cart__product__info-container");h.appendChild(c("span","product__title",e));const b=c("span","product__price","R$ ");b.appendChild(c("span","product__price__value",N(o))),h.appendChild(b),n.appendChild(h);const R=c("i","material-icons cart__product__remove","delete");return n.appendChild(R),n.addEventListener("click",()=>F(n,t)),n},V=({id:t,title:e,thumbnail:o,price:s})=>{const n=document.createElement("section");n.className="product",n.appendChild(c("span","product__id",t));const r=c("div","img__container");r.appendChild(f(o)),n.appendChild(r),n.appendChild(c("span","product__title",e));const i=c("span","product__price","R$ ");i.appendChild(c("span","product__price__value",N(s))),n.appendChild(i);const y=c("button","product__add","Adicionar ao carrinho!");return n.appendChild(y),n};const d=document.querySelector(".products"),x=document.querySelector("ol.cart__products"),z=document.querySelector(".total-price"),p=document.querySelector(".count-itens"),K=document.querySelector(".container-cartTitle"),Q=document.querySelector(".input-group"),l=document.getElementById("category-title"),k=document.getElementById("input-label"),m=document.getElementById("search"),a=document.getElementById("container-categories"),S=document.getElementById("list-categories"),u=document.querySelector(".cart"),g=document.querySelector(".container-title"),C=900,B=550,L=["category","q"],I=t=>t?`<section class="loading">
        <button class="btn" type="button" disabled>
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true">
          </span>
          Carregando...
        </button>
      </section>`:"",M=()=>{const t=document.querySelectorAll(".cart__product__info-container"),e=[...t];z.innerHTML=e.reduce((o,s,n)=>{const r=Number(t[n].lastChild.lastChild.innerText);return o+r},0).toFixed(2)},q=()=>{const t=document.querySelectorAll(".cart__product__info-container");t.length?(p.innerHTML=t.length,p.style.display="block"):(p.innerHTML=0,p.style.display="none",u.style.display="none",d.style.marginRight="0")},G=async()=>{const t=v();(await Promise.all(t.map(async o=>$(o)))).forEach(o=>{x.appendChild(T(o))}),M(),q()},O=t=>{d.innerHTML=`<section class="error">
  ${t.message}. Recarregue a página ou tente novamente!
  </section>`,console.error(t)},X=async()=>{const t=await A();S.innerHTML="",t.forEach(({id:e,name:o})=>{S.innerHTML+=`<li class="category">${o}
    <span class="id-category">${e}</span></li>`})},w=t=>{let e=JSON.parse(localStorage.getItem("preferences"));e?e[t]=e[t]?e[t]+1:1:e={[t]:1},localStorage.setItem("preferences",JSON.stringify(e))},Y=t=>Math.round(Math.random()*t),E=async(t="computador",e)=>{d.innerHTML=I(!0);const o=await j(t,e);if(d.innerHTML=I(!1),!o.length)throw new Error("Busca inválida! Item não encontrado/existe");o.forEach(s=>d.appendChild(V(s)))},Z=async t=>{const e=t.parentNode.firstChild.innerText;J(e);const o=await $(e);w(o.category_id),x.appendChild(T(o))};(async function(){try{await X();const e=JSON.parse(localStorage.getItem("preferences"));let o;if(e)[o]=Object.entries(e).reduce((n,[r,i])=>i>n[1]?[r,i]:n,["",0]);else{const n=document.getElementsByClassName("id-category"),r=Y(n.length-1);o=n[r].innerText}const s=o.includes("MLB")?0:1;await E(o,L[s]),await G()}catch(e){O(e)}})();Q.addEventListener("submit",async t=>{t.preventDefault();try{const{value:e}=document.getElementById("search");await E(e,L[1]),w(e)}catch(e){O(e)}});document.addEventListener("click",async t=>{const e=t.target;if(e.classList.contains("product__add")&&await Z(e),e.classList.contains("category")){await E(e.lastChild.innerText,L[0]),w(e.lastChild.innerText),a.style.display="none";const o=a.style.display==="none";o&&l.classList.remove("open"),window.innerWidth>C&&(d.style.marginLeft=o?`${a.clientWidth}px`:"0")}else M(),q()});document.querySelector(".cep-button").addEventListener("click",async()=>{const{value:t}=document.querySelector(".cep-input");await W(t)});K.addEventListener("click",()=>{const t=u.style.display==="none";Number(p.innerText)&&(u.style.display=t?"flex":"none",window.innerWidth>C?d.style.marginRight=t?`${u.clientWidth}px`:"0":(a.style.display=a.style.display!=="none"&&"none",a.style.display==="none"&&l.classList.remove("open")))});l.addEventListener("click",()=>{const t=a.style.display==="none";a.style.display=t?"block":"none",l.classList.contains("open")?l.classList.remove("open"):l.classList.add("open"),window.innerWidth>C?d.style.marginLeft=t?`${a.clientWidth}px`:"0":u.style.display=u.style.display!=="none"&&"none"});k.addEventListener("click",t=>{t.preventDefault(),window.innerWidth<=B&&(m.classList.contains("invisibleResponse")?(m.classList.remove("invisibleResponse"),m.focus(),g.classList.add("invisibleResponse")):(m.classList.add("invisibleResponse"),g.classList.remove("invisibleResponse")))});window.addEventListener("resize",()=>{window.innerWidth>B&&l.classList.contains("invisibleResponse")&&(g.classList.remove("invisibleResponse"),m.classList.add("invisibleResponse"))});
